{% comment %} pre-order date display - am {% endcomment %}
{% assign date-today =  "today" | date: "%s" %}
{% assign order-date = date-today %}

{% assign cart-item-counter = 1 %}
{% for item in cart.items %}
  {% assign metafield-date = item.variant.metafields.custom.pre_order_date | date: "%s" %}

  {% if metafield-date != empty %}
    {% if cart-item-counter == 1 %}
      {% if metafield-date > date-today %}
        {% assign order-date = metafield-date  %}
      {% endif %}
    {% else %}
      {% if metafield-date > order-date %}
        {% assign order-date = metafield-date %}
      {% endif %}
    {% endif %}

    {% assign cart-item-counter = cart-item-counter | plus: 1 %}
  {% endif %}
{% endfor %}

{% if order-date > date-today %}
  <div data-order-date class="cart-preorder">Order to be dispatched by {{ order-date | date: "%d %B"  }}</div>
{% else %}
  <div data-order-date ></div>
{% endif %}

{% comment %} order note - am {% endcomment %}
<div class="cart__item-row">
  <label for="CartNote" class="add-note">
    {{ 'cart.general.note' | t }}
    <span class="note-icon note-icon--open" aria-hidden="true">
      <svg aria-hidden="true" focusable="false" role="presentation" class="icon icon-pencil" viewBox="0 0 64 64"><defs><style>.cls-1,.cls-2{fill:none;stroke:#000;stroke-width:2px}.cls-1{stroke-miterlimit:10}</style></defs><path class="cls-1" d="M52 33.96V58H8V14h23.7"/><path class="cls-1" d="M18 47l13-5 24-24-8-8-24 24-5 13zM23 34l8 8"/><path id="svg_2" data-name="svg 2" class="cls-2" d="M47 10l1-1a5.44 5.44 0 0 1 7.82.18A5.52 5.52 0 0 1 56 17l-1 1"/></svg>
    </span>
    <span class="note-icon note-icon--close">
      <svg aria-hidden="true" focusable="false" role="presentation" class="icon icon-close" viewBox="0 0 64 64"><defs><style>.cls-1{fill:none;stroke:#000;stroke-miterlimit:10;stroke-width:2px}</style></defs><path class="cls-1" d="M19 17.61l27.12 27.13m0-27.13L19 44.74"/></svg>
      <span class="icon__fallback-text">{{ 'general.accessibility.close' | t }}</span>
    </span>
  </label>
  <textarea style="hide" name="preorder-note" class="input-full cart__note hide" id="CartPreorderNote">Order to be dispatched by {{ order-date | date: "%d %B"  }}</textarea>
</div>
