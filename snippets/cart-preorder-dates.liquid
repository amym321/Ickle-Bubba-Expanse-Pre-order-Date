{% comment %} pre-order date display - am {% endcomment %}
{% assign date-today =  "today" | date: "%s" %}
{% assign order-date = date-today %}

{% assign cart-item-counter = 1 %}
{% for item in cart.items %}
  {% assign metafield-date = item.variant.metafields.custom.pre_order_date | date: "%s" %}

  {% if metafield-date != empty %}
    {% if cart-item-counter == 1 %}
      {% if metafield-date > date-today %}
        {% assign order-date = metafield-date  %}
      {% endif %}
    {% else %}
      {% if metafield-date > order-date %}
        {% assign order-date = metafield-date %}
      {% endif %}
    {% endif %}

    {% assign cart-item-counter = cart-item-counter | plus: 1 %}
  {% endif %}
{% endfor %}

{% if order-date > date-today %}
  <div data-order-date class="cart-preorder">Order to be dispatched by {{ order-date | date: "%d %B"  }}</div>
  <textarea style="display:none;" data-preorder-note="Order to be dispatched by {{ order-date | date: "%d %B"  }}" id="CartPreorderNote">Order to be dispatched by {{ order-date | date: "%d %B"  }}</textarea>
  {% assign order-date-ISO = order-date | date: '%Y-%m-%d' %}
  <input  data-preorder-iso="{{order-date-ISO}}" type="text" name="attributes[preOrderDate: ]" value="{{order-date-ISO}}">
{% else %}
  <div data-order-date ></div>
  <textarea style="display:none;" data-preorder-note="" id="CartPreorderNote"></textarea>
  <input data-none data-preorder-iso="" type="text" name="attributes[preOrderDate: ]" value="">
{% endif %}

